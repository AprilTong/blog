---
title: åŸºäºŽvxe-table+Sortableçš„æ ‘å½¢è¡¨æ ¼è¡Œæ‹–åŠ¨
sidebar: auto
sidebarDepth: 2
date: 2023-10-20
tags:
    - Vue
---

### èƒŒæ™¯

ç›®å‰åœ¨å…¬å¸è´Ÿè´£çš„é¡¹ç›®æ˜¯ä½Žä»£ç å¹³å°ï¼Œæœ‰ä¸ªéœ€æ±‚æ˜¯éœ€è¦åœ¨å·¥ä½œæµä¸­é…ç½®å·¥ä½œè¡¨çš„å­—æ®µæƒé™å¹¶ä¸”å¯ä»¥æ‹–åŠ¨æŽ’åºã€‚åœ¨å·¥ä½œè¡¨ç¼–è¾‘ä¸­æ‹–æ‹½é…ç½®æŽ§ä»¶ä½¿ç”¨çš„ sortablejsï¼Œè¡¨æ ¼æ¸²æŸ“æ¶‰åŠåˆ°å•å…ƒæ ¼ç¼–è¾‘ä½¿ç”¨çš„ vxe-tableï¼Œæ‰€ä»¥æ¯«æ— ç–‘é—®å°±æ˜¯é€šè¿‡è¿™ä¸¤ä¸ªåŽ»å®žçŽ°å•¦ã€‚

## æ™®é€šè¡¨æ ¼è¡Œæ‹–åŠ¨æŽ’åº

æ‹–åŠ¨ç»“æŸäº‹ä»¶ä¸­æœ‰**oldIndex**å’Œ**newIndex**,æ‰€ä»¥å°±æ˜¯ä¸¤ä¸ªä½ç½®ä¸Šçš„å…ƒç´ äº’æ¢ä¸€ä¸‹å°±å¥½äº†ã€‚
[ç‚¹å‡»æŸ¥çœ‹ vxe-table å®˜ç½‘ demo](https://vxetable.cn/other4/#/table/other/sortableRow)

### é‚£æ ‘å½¢è¡¨æ ¼å¦‚ä½•å®žçŽ°å‘¢

å®˜ç½‘ä¹Ÿæœ‰ demoï¼Œä½†ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚åªèƒ½åœ¨åŒä¸€å±‚çº§æ‰å…è®¸ç›¸äº’æ‹–åŠ¨æŽ’åºã€‚æ‰€ä»¥æƒ³çš„å°±æ˜¯åœ¨æ‹–åŠ¨äº‹ä»¶ä¸­åˆ¤æ–­æ˜¯å¦åœ¨åŒä¸€å±‚çº§ï¼Œä¸åœ¨åŒä¸€å±‚çº§å°±ä¸å…è®¸æ‹–åŠ¨ã€‚ç„¶åŽæŠŠæ ‘å½¢æ•°æ®è½¬ä¸ºåˆ—è¡¨å†è¿›è¡ŒæŽ’åºã€‚

ä»£ç å®žçŽ°

```js
const createTableSort = () => {
  const el = document.querySelector('.body--wrapper>.vxe-table--body tbody') as HTMLElement
  if (!el) return
  if (sortTable.value) return
  sortTable.value = Sortable.create(el, {
    disabled: false, // æ˜¯å¦å¼€å¯æ‹–æ‹½
    animation: 150, // æ‹–æ‹½å»¶æ—¶ï¼Œæ•ˆæžœæ›´å¥½çœ‹
    handle: '.icon-move',
    sort: true,
    onMove: (evt: any) => {
      const { dragged, related } = evt

      const dragElClassList: string[] = []
      dragged.classList.forEach((element: string) => {
        if (element.includes('row--level')) {
          dragElClassList.push(element)
        }
      })

      const relatelClassList: string[] = []
      related.classList.forEach((element: string) => {
        if (element.includes('row--level')) {
          relatelClassList.push(element)
        }
      })
      // ä¸åŒå±‚çº§çš„ä¸èƒ½äº’ç›¸æ‹–åŠ¨
      // è¿™é‡Œé‡‡ç”¨æ¯”è¾ƒç¬¨çš„æ–¹æ³•å®žçŽ°,å¤§ä½¬ä»¬æŒ‡ç‚¹ä¸€ä¸‹æœ‰ä»€ä¹ˆæ›´å¥½çš„å®žçŽ°
      // isEqualé‡‡ç”¨lodashçš„æ–¹æ³•ï¼Œåˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰
      if (!isEqual(dragElClassList, relatelClassList)) return false
      return true
    },
    onEnd: async (evt: any) => {
      const { newIndex, oldIndex } = evt
      if (newIndex === oldIndex) return
      const expandRow = tableRef.value.getTreeExpandRecords()
      // å±•å¼€çš„æ•°æ®id
      const expandId = expandRow.map((item: RowVO) => item.id)
      const newTable: any[] = []
      // å°†å¤šç»´æ•°æ®å±•å¼€å­˜ä¸ºä¸€ç»´æ•°æ®
      const cloneData = tableData.value.map((o) => o)
      cloneData.forEach((item) => {
        // å¦‚æžœæœ‰å­ç±»å¹¶ä¸”è¯¥æ ‘å·²ç»å¼€å±•ï¼Œå°†å­ç±»ä¹Ÿpushè¿›åŽ»
        if (expandId.includes(item.id) && item.children && item.children.length > 0) {
          newTable.push({
            ...item,
            useChild: false
          })
          item.children.forEach((i) => {
            i.parentId = item.id
            newTable.push(i)
          })
        } else {
          newTable.push({
            ...item,
            useChild: true
          })
        }
      })
      const currRow = cloneDeep(newTable[oldIndex])
      newTable?.splice(oldIndex, 1)
      newTable?.splice(newIndex, 0, currRow)
      // ç„¶åŽæŠŠæŽ’åºæˆåŠŸåŽçš„ä¸€ç»´æ•°æ®è½¬ä¸ºæ ‘å½¢æ•°æ®
      const result: any[] = []
      newTable.forEach((item) => {
        // ä¸€çº§
        if (!item.parentId) {
          // è®¾ç½®å­çº§
          if (!item.useChild) {
            item.children = newTable.filter((one) => one.parentId === item.id)
          }
          result.push(item)
        }
      })
      // èµ‹å€¼åˆ°æ•°æ®,å¯ä»¥ä¼ ç»™åŽç«¯
      tableData.value = result
      nextTick(() => {
        // é‡æ–°åŠ è½½æ•°æ®
        tableRef.value.reloadData(result)
        nextTick(() => {
            // ä¹‹å‰å±•å¼€çš„æ•°æ®é‡æ–°å±•å¼€
          tableRef.value.setTreeExpand(expandRow, true)
        })
      })
    }
  })
}
```

## æ€è€ƒæ›´å¤šï¼šå¦‚æžœæ ‘çš„å±‚çº§æœ‰å¾ˆæ·±å‘¢

å±‚çº§å¾ˆæ·±çš„è¯å‘¢...ðŸ¤” å¦‚æžœåªæ‹–åŠ¨ç¬¬ä¸‰å±‚,æŒ‰ç…§æˆ‘ä¸Šé¢çš„æ–¹æ³•å®žçŽ°æ€è·¯èµ·æ¥å°±å¾ˆè€—æ€§èƒ½ï¼Œæ¯æ‹–åŠ¨ä¸€æ¬¡å°±å¾—æ¥å›žè½¬æ¢æ•°æ®,ä½†å…¶å®žæˆ‘åªè¦æ›´æ¢æ‹–åŠ¨é‚£ä¸€å±‚å…ƒç´ çš„é¡ºåºå°±å¥½äº†ã€‚ä½†æ˜¯åœ¨æ‹–åŠ¨äº‹ä»¶ä¸­æˆ‘ä»¬åªèƒ½æ‹¿åˆ°æ˜¾ç¤ºæ•°æ®çš„ç´¢å¼•ï¼Œæ€Žä¹ˆå’ŒçœŸå®žæ ‘å½¢æ•°æ®å¯¹åº”ä¸Šå‘¢ï¼Ÿå¥½åƒå»ºç«‹ä¸€ä¸ªæ˜ å°„æ˜¯ä¸æ˜¯å¯ä»¥å‘¢ï¼Œå—¯ï¼Œé‚£å°±è¯•è¯•ï¼

ä½ ä»¬æœ‰æ›´å¥½çš„æ–¹æ³•å¿«æ¥å‘Šè¯‰æˆ‘å‘€ï½žï½ž

[æŸ¥çœ‹æ¼”ç¤ºæ•ˆæžœ](https://april-tong.com/sycamore-cottage/#/dashboard/table)

[æŸ¥çœ‹å®Œæ•´ä»£ç ](https://github.com/AprilTong/sycamore-cottage/blob/master/src/pages/dashboard/table.vue)

```js
// ä¸»è¦æ˜¯ onEnd äº‹ä»¶çš„é€»è¾‘æœ‰åŒºåˆ«ã€‚
onEnd: (evt: any) => {
    const { newIndex, oldIndex } = evt
    if (newIndex === oldIndex) return
    const expandRow = tableRef.value.getTreeExpandRecords()
    // å±•å¼€çš„æ•°æ®id
    const expandId = expandRow.map((item: RowVO) => item.id)
    // å°†å¤šç»´æ•°æ®å±•å¼€å­˜ä¸ºä¸€ç»´æ•°æ®
    const cloneData = tableData.value.map((o) => o)
    let count = -1
    const result: any = {}
    const getMap = (data: any[], parentIndex = '') => {
        data.forEach((item, index) => {
            // å¦‚æžœæœ‰å­ç±»ï¼Œå°†å­ç±»ä¹Ÿpushè¿›åŽ»
            item.selfIndex = parentIndex === '' ? `${index}` : `${parentIndex}-${index}`
            result[++count] = item.selfIndex
            if (expandId.includes(item.id) && item.children && item.children.length > 0) {
                getMap(item.children, item.selfIndex)
            }
        })
    }
    getMap(cloneData)
    // äº¤æ¢å¯¹åº”çš„
    const oldRealIndex = result[oldIndex]
    const newRealIndex = result[newIndex]
    if (oldRealIndex.length === 1 && newRealIndex.length === 1) {
        const currRow = cloneDeep(tableData.value[oldRealIndex])
        tableData.value?.splice(oldRealIndex, 1)
        tableData.value?.splice(newRealIndex, 0, currRow)
    } else {
        const parentIndex = oldRealIndex.slice(0, -2)
        const tempOldIndex = oldRealIndex.slice(oldRealIndex.length - 1)
        const tempNewIndex = newRealIndex.slice(oldRealIndex.length - 1)
        const getCurrent = (arr: RowVO[]) => {
            arr.forEach((item) => {
                if (item.selfIndex === parentIndex && item.children?.length) {
                    const currRow = item.children[tempOldIndex]
                    item.children?.splice(tempOldIndex, 1)
                    item.children?.splice(tempNewIndex, 0, currRow)
                }
                if (item.children?.length) {
                    getCurrent(item.children)
                }
            })
        }
        getCurrent(tableData.value)
    }
    console.log('tableData', tableData.value)
    // èµ‹å€¼åˆ°æ•°æ®,å¯ä»¥ä¼ ç»™åŽç«¯
    tableRef.value.reloadData(tableData.value)
    nextTick(() => {
        tableRef.value.setTreeExpand(expandRow, true)
    })
}
```

## ç›¸å…³æ–‡ç« 

-   [vxe-table å®˜ç½‘](https://vxetable.cn/#/table/start/install)
-   [sortable.js ä¸­æ–‡æ–‡æ¡£](https://www.itxst.com/sortablejs/neuinffi.html)
